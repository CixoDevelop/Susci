\hypertarget{Time_8h_source}{}\doxysection{Time.\+h}
\label{Time_8h_source}\index{Susci/Kernel/Time.h@{Susci/Kernel/Time.h}}
\mbox{\hyperlink{Time_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ * }}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other }}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ * }}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ *}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * This file stores all the functions needed to maintain system time, with the }}
\DoxyCodeLine{14 \textcolor{comment}{ * exception of the getTime function which is platform dependent.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 }
\DoxyCodeLine{18 \textcolor{preprocessor}{\#ifndef KERNEL\_TIME\_H\_INCLUDED}}
\DoxyCodeLine{19 \textcolor{preprocessor}{\#define KERNEL\_TIME\_H\_INCLUDED}}
\DoxyCodeLine{20 }
\DoxyCodeLine{21 }
\DoxyCodeLine{26 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{Time_8h_ab3198b6e3699ff192caa2e0c0179a6ff}{wait}}(\mbox{\hyperlink{ATtiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} how\_long\_wait) \{}
\DoxyCodeLine{27     \mbox{\hyperlink{Scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} = \mbox{\hyperlink{Process_8h_ab97efa0d1c4aeaf55ff756bf16685854a5c51553606dc48acb370c3b60ca12035}{TIMER\_STATE}};}
\DoxyCodeLine{28 }
\DoxyCodeLine{29     \mbox{\hyperlink{ATtiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} actual\_time = \mbox{\hyperlink{Platform_8h_a2573781dcdeb21b82f54574ae060be82}{get\_time}}();}
\DoxyCodeLine{30     \mbox{\hyperlink{ATtiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} left\_to\_rewind = \mbox{\hyperlink{ATtiny261_8h_a2dd161bf85c6331fe6017ab48cf9577d}{MAX\_SYSTEM\_TIME}} -\/ actual\_time;}
\DoxyCodeLine{31     }
\DoxyCodeLine{32     \textcolor{keywordflow}{if} (left\_to\_rewind < how\_long\_wait) \{}
\DoxyCodeLine{33         \mbox{\hyperlink{Scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a1f02cc30b8377640c1101c33e0bb8c7e}{scheduler\_context}} = how\_long\_wait -\/ left\_to\_rewind;}
\DoxyCodeLine{34     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{35         \mbox{\hyperlink{Scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a1f02cc30b8377640c1101c33e0bb8c7e}{scheduler\_context}} = actual\_time + how\_long\_wait;}
\DoxyCodeLine{36     \}}
\DoxyCodeLine{37 \}}
\DoxyCodeLine{38 }
\DoxyCodeLine{44 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{Time_8h_a87e04c079eb92c9c848eca8c8819dd0c}{check\_timer\_processes}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{45     \textcolor{keyword}{static} \mbox{\hyperlink{ATtiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} latest\_loop = 0x0;}
\DoxyCodeLine{46     }
\DoxyCodeLine{47     \mbox{\hyperlink{ATtiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} recent\_loop = latest\_loop;}
\DoxyCodeLine{48     latest\_loop = \mbox{\hyperlink{Platform_8h_a2573781dcdeb21b82f54574ae060be82}{get\_time}}();}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{keywordflow}{if} (recent\_loop == \mbox{\hyperlink{ATtiny261_8h_a2dd161bf85c6331fe6017ab48cf9577d}{MAX\_SYSTEM\_TIME}} \&\& recent\_loop > latest\_loop) \{}
\DoxyCodeLine{51         recent\_loop = 0;}
\DoxyCodeLine{52     \}}
\DoxyCodeLine{53 }
\DoxyCodeLine{54     \textcolor{keywordflow}{if} (recent\_loop > latest\_loop) \{}
\DoxyCodeLine{55         latest\_loop = \mbox{\hyperlink{ATtiny261_8h_a2dd161bf85c6331fe6017ab48cf9577d}{MAX\_SYSTEM\_TIME}};}
\DoxyCodeLine{56     \}}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \mbox{\hyperlink{structprocess__t}{process\_t}} *to\_wake\_up = \mbox{\hyperlink{Scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}} + \mbox{\hyperlink{DefaultSettings_8h_a6f363716dc292fe43b665809b9f724e9}{PROCESS\_HEAP\_SIZE}};}
\DoxyCodeLine{59 }
\DoxyCodeLine{60     \textcolor{keywordflow}{while} (to\_wake\_up-\/-\/ > \mbox{\hyperlink{Scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}) \{}
\DoxyCodeLine{61         \textcolor{keywordflow}{if} (to\_wake\_up-\/>\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} != \mbox{\hyperlink{Process_8h_ab97efa0d1c4aeaf55ff756bf16685854a5c51553606dc48acb370c3b60ca12035}{TIMER\_STATE}}) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{62 }
\DoxyCodeLine{63         \textcolor{keywordflow}{if} (}
\DoxyCodeLine{64             to\_wake\_up-\/>\mbox{\hyperlink{structprocess__t_a1f02cc30b8377640c1101c33e0bb8c7e}{scheduler\_context}} >= recent\_loop }
\DoxyCodeLine{65             \&\& to\_wake\_up-\/>\mbox{\hyperlink{structprocess__t_a1f02cc30b8377640c1101c33e0bb8c7e}{scheduler\_context}} <= latest\_loop}
\DoxyCodeLine{66         ) to\_wake\_up-\/>\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} = \mbox{\hyperlink{Process_8h_ab97efa0d1c4aeaf55ff756bf16685854a8f383efff27b80ddb4ab5ffd6acfe51e}{READY\_STATE}};}
\DoxyCodeLine{67     \}}
\DoxyCodeLine{68 \}}
\DoxyCodeLine{69 }
\DoxyCodeLine{70 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
