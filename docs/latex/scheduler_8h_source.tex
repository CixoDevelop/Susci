\hypertarget{scheduler_8h_source}{}\doxysection{scheduler.\+h}
\label{scheduler_8h_source}\index{susci/kernel/scheduler.h@{susci/kernel/scheduler.h}}
\mbox{\hyperlink{scheduler_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ * }}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other }}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ * }}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ *}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * This file stores the system scheduler, process heap, and other items needed}}
\DoxyCodeLine{14 \textcolor{comment}{ * for the running of the system kernel.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#ifndef KERNEL\_SCHEDULER\_H\_INCLUDED}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define KERNEL\_SCHEDULER\_H\_INCLUDED}}
\DoxyCodeLine{19 }
\DoxyCodeLine{23 \textcolor{preprocessor}{\#ifndef PROCESS\_HEAP\_SIZE}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define PROCESS\_HEAP\_SIZE 4}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{26 }
\DoxyCodeLine{30 \textcolor{preprocessor}{\#define MAX\_PID PROCESS\_HEAP\_SIZE -\/ 1}}
\DoxyCodeLine{31 }
\DoxyCodeLine{35 \textcolor{preprocessor}{\#define FULL\_PROCESS\_HEAP PROCESS\_HEAP\_SIZE}}
\DoxyCodeLine{36 }
\DoxyCodeLine{40 \textcolor{preprocessor}{\#define MAX\_PRIORITY\_PROCESS process\_heap + MAX\_PID}}
\DoxyCodeLine{41 }
\DoxyCodeLine{45 \textcolor{preprocessor}{\#define MIN\_PRIORITY\_PROCESS process\_heap}}
\DoxyCodeLine{46 }
\DoxyCodeLine{51 \mbox{\hyperlink{structprocess__t}{process\_t}} \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[\mbox{\hyperlink{scheduler_8h_a6f363716dc292fe43b665809b9f724e9}{PROCESS\_HEAP\_SIZE}}];}
\DoxyCodeLine{52 }
\DoxyCodeLine{57 \mbox{\hyperlink{structprocess__t}{process\_t}} *\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}};}
\DoxyCodeLine{58 }
\DoxyCodeLine{64 \mbox{\hyperlink{types_8h_aedfd99612f33cabeb5d2af288bcd95a5}{signal\_t}} \mbox{\hyperlink{scheduler_8h_ab12a07b51b2d02d031de0ad1489d6ac0}{current\_signal}};}
\DoxyCodeLine{65 }
\DoxyCodeLine{71 \textcolor{keyword}{static} \mbox{\hyperlink{types_8h_ab612a3a4eb0e2ced1e55ecff76260458}{pid\_t}} \mbox{\hyperlink{scheduler_8h_aaa1a1333ef89c2371c7b9c150f48f8b8}{get\_first\_empty}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{72     \mbox{\hyperlink{types_8h_ab612a3a4eb0e2ced1e55ecff76260458}{pid\_t}} empty\_process\_pid = \mbox{\hyperlink{scheduler_8h_a6f363716dc292fe43b665809b9f724e9}{PROCESS\_HEAP\_SIZE}};}
\DoxyCodeLine{73     }
\DoxyCodeLine{74     \textcolor{keywordflow}{while} (empty\_process\_pid-\/-\/) \{ }
\DoxyCodeLine{75         \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[empty\_process\_pid].state == \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854ae84991320294ae356ec5a01256f15e4e}{EMPTY\_STATE}}) \{}
\DoxyCodeLine{76             \textcolor{keywordflow}{return} empty\_process\_pid;}
\DoxyCodeLine{77         \}}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{keywordflow}{return} \mbox{\hyperlink{scheduler_8h_a066ef5e451cae5a6858d01a52fda43a2}{FULL\_PROCESS\_HEAP}};}
\DoxyCodeLine{81 \}}
\DoxyCodeLine{82 }
\DoxyCodeLine{92 \textcolor{keyword}{static} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} \mbox{\hyperlink{scheduler_8h_ae6382cc33ecc12e65b03fd6fe729d786}{create\_process}}(}
\DoxyCodeLine{93     \mbox{\hyperlink{types_8h_ab612a3a4eb0e2ced1e55ecff76260458}{pid\_t}} process\_pid,}
\DoxyCodeLine{94     \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} (*worker)(\textcolor{keywordtype}{void}*), }
\DoxyCodeLine{95     \textcolor{keywordtype}{void} *parameter}
\DoxyCodeLine{96 ) \{}
\DoxyCodeLine{97     \textcolor{keywordflow}{if} (process\_pid > \mbox{\hyperlink{scheduler_8h_a36b11288ada38ae09b8033e32f738c3d}{MAX\_PID}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a69337d8c64c1bf6f8006f9771da4bbb0}{PANIC\_STATE}};}
\DoxyCodeLine{98 }
\DoxyCodeLine{99     \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[process\_pid].state != \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854ae84991320294ae356ec5a01256f15e4e}{EMPTY\_STATE}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a69337d8c64c1bf6f8006f9771da4bbb0}{PANIC\_STATE}};}
\DoxyCodeLine{100 }
\DoxyCodeLine{101     \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[process\_pid].\mbox{\hyperlink{structprocess__t_af89fcf2abe8f35fd8543c8049a33654b}{worker}} = worker;}
\DoxyCodeLine{102     \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[process\_pid].\mbox{\hyperlink{structprocess__t_a714f63ea56069df96e8268cbde6406ff}{parameter}} = parameter;}
\DoxyCodeLine{103     \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[process\_pid].\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} = \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854a8f383efff27b80ddb4ab5ffd6acfe51e}{READY\_STATE}};}
\DoxyCodeLine{104 }
\DoxyCodeLine{105     \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a1501174ec155cb62cc1332781e9b7edf}{GOOD\_STATE}};}
\DoxyCodeLine{106 \}}
\DoxyCodeLine{107 }
\DoxyCodeLine{111 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{scheduler_8h_a0685c7e91a71454be4141fc70e324eb2}{kill\_current\_process}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{112     \mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} = \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854ae84991320294ae356ec5a01256f15e4e}{EMPTY\_STATE}};}
\DoxyCodeLine{113 \}}
\DoxyCodeLine{114 }
\DoxyCodeLine{120 \textcolor{keyword}{static} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} \mbox{\hyperlink{scheduler_8h_ab09238d6a7457d471a51813508a6a927}{kill\_process}}(\mbox{\hyperlink{types_8h_ab612a3a4eb0e2ced1e55ecff76260458}{pid\_t}} to\_kill) \{}
\DoxyCodeLine{121     \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[to\_kill].state == \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854ae84991320294ae356ec5a01256f15e4e}{EMPTY\_STATE}}) \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a69337d8c64c1bf6f8006f9771da4bbb0}{PANIC\_STATE}};}
\DoxyCodeLine{122     }
\DoxyCodeLine{123     \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[to\_kill].\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} = \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854ae84991320294ae356ec5a01256f15e4e}{EMPTY\_STATE}};}
\DoxyCodeLine{124 }
\DoxyCodeLine{125     \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a1501174ec155cb62cc1332781e9b7edf}{GOOD\_STATE}};}
\DoxyCodeLine{126 \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{132 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{scheduler_8h_adaa8949819df9fcef28b31188811d65f}{scheduler\_init}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{133     \mbox{\hyperlink{types_8h_ab612a3a4eb0e2ced1e55ecff76260458}{pid\_t}} current\_pid = \mbox{\hyperlink{scheduler_8h_a36b11288ada38ae09b8033e32f738c3d}{MAX\_PID}};}
\DoxyCodeLine{134 }
\DoxyCodeLine{135     \textcolor{keywordflow}{while} (current\_pid-\/-\/) \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}[current\_pid].\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} = \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854ae84991320294ae356ec5a01256f15e4e}{EMPTY\_STATE}}; }
\DoxyCodeLine{136 }
\DoxyCodeLine{137     \mbox{\hyperlink{scheduler_8h_ab12a07b51b2d02d031de0ad1489d6ac0}{current\_signal}} = 0x00;}
\DoxyCodeLine{138 \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{145 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} \mbox{\hyperlink{scheduler_8h_ac0e9c8944486d1101de37eb0a3111114}{signal\_scheduler}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{146     \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_ab12a07b51b2d02d031de0ad1489d6ac0}{current\_signal}} == 0x00) \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97aeca4500f6f729608a014643f8c8f4003}{IDLE\_STATE}};}
\DoxyCodeLine{147 }
\DoxyCodeLine{148     \textcolor{comment}{/* }}
\DoxyCodeLine{149 \textcolor{comment}{     * This make local copy of signal, bacause when signal ia processing, any }}
\DoxyCodeLine{150 \textcolor{comment}{     * interrupt can change global signal flag}}
\DoxyCodeLine{151 \textcolor{comment}{     */}}
\DoxyCodeLine{152     \mbox{\hyperlink{types_8h_aedfd99612f33cabeb5d2af288bcd95a5}{signal\_t}} signal = \mbox{\hyperlink{scheduler_8h_ab12a07b51b2d02d031de0ad1489d6ac0}{current\_signal}};}
\DoxyCodeLine{153     \mbox{\hyperlink{scheduler_8h_ab12a07b51b2d02d031de0ad1489d6ac0}{current\_signal}} = 0x00;}
\DoxyCodeLine{154 }
\DoxyCodeLine{155     \textcolor{comment}{/*}}
\DoxyCodeLine{156 \textcolor{comment}{     * This check all processes, all of it who has SIGNAL state had been}}
\DoxyCodeLine{157 \textcolor{comment}{     * checked and these who had been marked for same signal will be executed}}
\DoxyCodeLine{158 \textcolor{comment}{     */}}
\DoxyCodeLine{159     \mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}} = \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}} + \mbox{\hyperlink{scheduler_8h_a6f363716dc292fe43b665809b9f724e9}{PROCESS\_HEAP\_SIZE}};}
\DoxyCodeLine{160 }
\DoxyCodeLine{161     \textcolor{keywordflow}{while} (\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/-\/ > \mbox{\hyperlink{scheduler_8h_afac40b9e4d088dc1677596241e09279c}{process\_heap}}) \{}
\DoxyCodeLine{162         \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} != \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854a1510c195e40c14d3f857d213f7c4b877}{SIGNAL\_STATE}}) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{163 }
\DoxyCodeLine{164         \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a1f02cc30b8377640c1101c33e0bb8c7e}{scheduler\_context}} != signal) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{165         }
\DoxyCodeLine{166         \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} return\_state }
\DoxyCodeLine{167         = \mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_af89fcf2abe8f35fd8543c8049a33654b}{worker}}(\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a714f63ea56069df96e8268cbde6406ff}{parameter}});}
\DoxyCodeLine{168 }
\DoxyCodeLine{169         \textcolor{keywordflow}{if} (return\_state == \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97aeca4500f6f729608a014643f8c8f4003}{IDLE\_STATE}}) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{170         }
\DoxyCodeLine{171         \textcolor{keywordflow}{return} return\_state;}
\DoxyCodeLine{172     \}}
\DoxyCodeLine{173 }
\DoxyCodeLine{174     \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a1501174ec155cb62cc1332781e9b7edf}{GOOD\_STATE}};}
\DoxyCodeLine{175 \}}
\DoxyCodeLine{176 }
\DoxyCodeLine{182 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} \mbox{\hyperlink{scheduler_8h_a09c2bbee3d3d137684fec619c5e524c2}{standard\_scheduler}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{183     \mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}} = \mbox{\hyperlink{scheduler_8h_a272968d67e0c945010bc497ab5c8a997}{MAX\_PRIORITY\_PROCESS}};}
\DoxyCodeLine{184 }
\DoxyCodeLine{185     \textcolor{keywordflow}{while} (\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/-\/ > \mbox{\hyperlink{scheduler_8h_a3e6fdca565706f314397b394c3b5d8b5}{MIN\_PRIORITY\_PROCESS}}) \{}
\DoxyCodeLine{186         \textcolor{keywordflow}{if} (\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a40e84a87e647e4e0f10f32668c8ed3ab}{state}} != \mbox{\hyperlink{process_8h_ab97efa0d1c4aeaf55ff756bf16685854a8f383efff27b80ddb4ab5ffd6acfe51e}{READY\_STATE}}) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{187 }
\DoxyCodeLine{188         \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} process\_state  }
\DoxyCodeLine{189         = \mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_af89fcf2abe8f35fd8543c8049a33654b}{worker}}(\mbox{\hyperlink{scheduler_8h_a5778e355bd0a767b6843c2a209f8f7cc}{current\_process}}-\/>\mbox{\hyperlink{structprocess__t_a714f63ea56069df96e8268cbde6406ff}{parameter}});}
\DoxyCodeLine{190 }
\DoxyCodeLine{191         \textcolor{keywordflow}{if} (process\_state == \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97aeca4500f6f729608a014643f8c8f4003}{IDLE\_STATE}}) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{192 }
\DoxyCodeLine{193         \textcolor{keywordflow}{return} process\_state;}
\DoxyCodeLine{194     \}}
\DoxyCodeLine{195 }
\DoxyCodeLine{196     \textcolor{keywordflow}{return} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97a1501174ec155cb62cc1332781e9b7edf}{GOOD\_STATE}};}
\DoxyCodeLine{197 \}}
\DoxyCodeLine{198 }
\DoxyCodeLine{205 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} \mbox{\hyperlink{scheduler_8h_aff54f8cf16cea2d049eb6107effb9c9e}{scheduler\_loop}}(\textcolor{keywordtype}{void}) \{   }
\DoxyCodeLine{206     \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} signal = \mbox{\hyperlink{scheduler_8h_ac0e9c8944486d1101de37eb0a3111114}{signal\_scheduler}}();}
\DoxyCodeLine{207 }
\DoxyCodeLine{208     \textcolor{keywordflow}{if} (signal != \mbox{\hyperlink{process_8h_aeccc645031be90ded0759d4192ce2a97aeca4500f6f729608a014643f8c8f4003}{IDLE\_STATE}}) \textcolor{keywordflow}{return} signal;}
\DoxyCodeLine{209 }
\DoxyCodeLine{210     \textcolor{keywordflow}{return} \mbox{\hyperlink{scheduler_8h_a09c2bbee3d3d137684fec619c5e524c2}{standard\_scheduler}}();}
\DoxyCodeLine{211 \}}
\DoxyCodeLine{212 }
\DoxyCodeLine{213 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
