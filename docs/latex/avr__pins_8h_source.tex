\hypertarget{avr__pins_8h_source}{}\doxysection{avr\+\_\+pins.\+h}
\label{avr__pins_8h_source}\index{susci/drivers/integrated/avr\_pins.h@{susci/drivers/integrated/avr\_pins.h}}
\mbox{\hyperlink{avr__pins_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other}}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ *}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * This file stores drivers that is responsible for managment of microcontroller}}
\DoxyCodeLine{14 \textcolor{comment}{ * pins. This can return pointers to hardware or atomic change pin state.}}
\DoxyCodeLine{15 \textcolor{comment}{ */}}
\DoxyCodeLine{16 }
\DoxyCodeLine{17 \textcolor{preprocessor}{\#ifndef DRIVERS\_INTEGRATED\_AVRPINS\_H\_INCLUDED}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#define DRIVERS\_INTEGRATED\_AVRPINS\_H\_INCLUDED}}
\DoxyCodeLine{19 }
\DoxyCodeLine{23 \textcolor{keyword}{typedef} uint8\_t \mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}};}
\DoxyCodeLine{24 }
\DoxyCodeLine{28 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{29 }
\DoxyCodeLine{30     \textcolor{comment}{/* Input state */}}
\DoxyCodeLine{31     \mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8ae310c909d76b003d016bef8bdf16936a}{INPUT}} = 0,}
\DoxyCodeLine{32 }
\DoxyCodeLine{33     \textcolor{comment}{/* Output state */}}
\DoxyCodeLine{34     \mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8a2ab08d3e103968f5f4f26b66a52e99d6}{OUTPUT}} = 1}
\DoxyCodeLine{35 }
\DoxyCodeLine{36 \} \mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8}{pin\_direction\_t}};}
\DoxyCodeLine{37 }
\DoxyCodeLine{41 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{42 }
\DoxyCodeLine{43     \textcolor{comment}{/* Low state 0V */}}
\DoxyCodeLine{44     \mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7a6a226f4143ca3b18999551694cdb72a8}{LOW}} = 0,}
\DoxyCodeLine{45     }
\DoxyCodeLine{46     \textcolor{comment}{/* High state 3V3 or 5V */}}
\DoxyCodeLine{47     \mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7a0c3a1dacf94061154b3ee354359c5893}{HIGH}} = 1}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \} \mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7}{pin\_state\_t}};}
\DoxyCodeLine{50 }
\DoxyCodeLine{56 \textcolor{keyword}{static} \textcolor{keyword}{volatile} uint8\_t *\mbox{\hyperlink{avr__pins_8h_aea7ebd8a4464d1fd954e3ba1363932a8}{create\_pin\_direction\_pointer}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number) \{}
\DoxyCodeLine{57     \textcolor{keywordflow}{return}}
\DoxyCodeLine{58         (\textcolor{keyword}{volatile} uint8\_t *) (\mbox{\hyperlink{attiny261_8h_a83e996eaa5c5a51d7c9a077f5b59538f}{LOW\_DDR}}  + (((uint8\_t) (pin\_number / 8)) * 3));}
\DoxyCodeLine{59 \}}
\DoxyCodeLine{60 }
\DoxyCodeLine{66 \textcolor{keyword}{static} \textcolor{keyword}{volatile} uint8\_t *\mbox{\hyperlink{avr__pins_8h_a05351fa1a2f2fada0104e9858400027d}{create\_pin\_input\_pointer}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number) \{}
\DoxyCodeLine{67     \textcolor{keywordflow}{return}}
\DoxyCodeLine{68         (\textcolor{keyword}{volatile} uint8\_t *) (\mbox{\hyperlink{attiny261_8h_ab080d69b67da115e2bb07f54243ce7b5}{LOW\_PIN}}  + (((uint8\_t) (pin\_number / 8)) * 3));}
\DoxyCodeLine{69 \}}
\DoxyCodeLine{70 }
\DoxyCodeLine{76 \textcolor{keyword}{static} \textcolor{keyword}{volatile} uint8\_t *\mbox{\hyperlink{avr__pins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number) \{}
\DoxyCodeLine{77     \textcolor{keywordflow}{return}}
\DoxyCodeLine{78         (\textcolor{keyword}{volatile} uint8\_t *) (\mbox{\hyperlink{attiny261_8h_ae220315a1b7fb3c1cb346a193e620f2f}{LOW\_PORT}}  + (((uint8\_t) (pin\_number / 8)) * 3));}
\DoxyCodeLine{79 \}}
\DoxyCodeLine{80 }
\DoxyCodeLine{86 \textcolor{keyword}{static} \textcolor{keyword}{inline} uint8\_t \mbox{\hyperlink{avr__pins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number) \{}
\DoxyCodeLine{87     \textcolor{keywordflow}{return} \_BV(pin\_number \% 8);}
\DoxyCodeLine{88 \}}
\DoxyCodeLine{89 }
\DoxyCodeLine{95 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{avr__pins_8h_abaeae1ae429eeb695ef939249b988a01}{set\_pin\_direction}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number, \mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8}{pin\_direction\_t}} new\_direction) \{}
\DoxyCodeLine{96     uint8\_t mask = \mbox{\hyperlink{avr__pins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(pin\_number);}
\DoxyCodeLine{97     \textcolor{keyword}{volatile} uint8\_t *direction = \mbox{\hyperlink{avr__pins_8h_aea7ebd8a4464d1fd954e3ba1363932a8}{create\_pin\_direction\_pointer}}(pin\_number);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99     \textcolor{comment}{/* This is atomic operation */}}
\DoxyCodeLine{100     uint8\_t sreg = SREG;}
\DoxyCodeLine{101     cli ();}
\DoxyCodeLine{102 }
\DoxyCodeLine{103     \textcolor{keywordflow}{if} (new\_direction == \mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8a2ab08d3e103968f5f4f26b66a52e99d6}{OUTPUT}}) *direction |= mask;}
\DoxyCodeLine{104     \textcolor{keywordflow}{else} *direction \&= \string~mask;}
\DoxyCodeLine{105 }
\DoxyCodeLine{106     SREG = sreg;}
\DoxyCodeLine{107 \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{115 \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{avr__pins_8h_a7b9a0dd7fafbe756e48f51279cfe943e}{set\_pin\_state}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number, \mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7}{pin\_state\_t}} new\_state) \{}
\DoxyCodeLine{116     uint8\_t mask = \mbox{\hyperlink{avr__pins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(pin\_number);}
\DoxyCodeLine{117     \textcolor{keyword}{volatile} uint8\_t *output = \mbox{\hyperlink{avr__pins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(pin\_number);}
\DoxyCodeLine{118 }
\DoxyCodeLine{119     \textcolor{comment}{/* This is atomic operation */}}
\DoxyCodeLine{120     uint8\_t sreg = SREG;}
\DoxyCodeLine{121     cli();}
\DoxyCodeLine{122 }
\DoxyCodeLine{123     \textcolor{keywordflow}{if} (new\_state == \mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7a0c3a1dacf94061154b3ee354359c5893}{HIGH}}) *output |= mask;}
\DoxyCodeLine{124     \textcolor{keywordflow}{else} *output \&= \string~mask;}
\DoxyCodeLine{125 }
\DoxyCodeLine{126     SREG = sreg;}
\DoxyCodeLine{127 \}}
\DoxyCodeLine{128 }
\DoxyCodeLine{133 \textcolor{keyword}{static} \mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8}{pin\_direction\_t}} \mbox{\hyperlink{avr__pins_8h_a8a391006a8c22d4ad285d38bad8f47d9}{get\_pin\_direction}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number) \{}
\DoxyCodeLine{134     \textcolor{keywordflow}{return} (\mbox{\hyperlink{avr__pins_8h_a7922c03a2bda124c487262edc028e1b8}{pin\_direction\_t}}) (}
\DoxyCodeLine{135         (*\mbox{\hyperlink{avr__pins_8h_aea7ebd8a4464d1fd954e3ba1363932a8}{create\_pin\_direction\_pointer}}(pin\_number) \& \mbox{\hyperlink{avr__pins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(pin\_number)) }
\DoxyCodeLine{136         != 0}
\DoxyCodeLine{137     );}
\DoxyCodeLine{138 \}}
\DoxyCodeLine{139 }
\DoxyCodeLine{144 \textcolor{keyword}{static} \mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7}{pin\_state\_t}} \mbox{\hyperlink{avr__pins_8h_a85bdd2833769ee44f7980f69e826dea5}{get\_pin\_state}}(\mbox{\hyperlink{avr__pins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} pin\_number) \{}
\DoxyCodeLine{145     \textcolor{keywordflow}{return} (\mbox{\hyperlink{avr__pins_8h_a3743a299cfb0cd5b1e1e8d00c75261b7}{pin\_state\_t}}) (}
\DoxyCodeLine{146         *\mbox{\hyperlink{avr__pins_8h_a05351fa1a2f2fada0104e9858400027d}{create\_pin\_input\_pointer}}(pin\_number) \& \mbox{\hyperlink{avr__pins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(pin\_number)}
\DoxyCodeLine{147     );}
\DoxyCodeLine{148 \}}
\DoxyCodeLine{149 }
\DoxyCodeLine{150 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
