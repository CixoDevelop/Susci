\hypertarget{TwiSlave_8h_source}{}\doxysection{Twi\+Slave.\+h}
\label{TwiSlave_8h_source}\index{Susci/Communication/TwiSlave.h@{Susci/Communication/TwiSlave.h}}
\mbox{\hyperlink{TwiSlave_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other}}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ *}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * This file stores the general data structures and functions needed by each}}
\DoxyCodeLine{14 \textcolor{comment}{ * TWI slave implementation for each platform. The elements contained therein}}
\DoxyCodeLine{15 \textcolor{comment}{ * constitute the basis on which the TWI slave implementation is then placed.}}
\DoxyCodeLine{16 \textcolor{comment}{ */}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#ifndef COMMUNICATION\_TWI\_SLAVE\_H\_INCLUDED }}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define COMMUNICATION\_TWI\_SLAVE\_H\_INCLUDED }}
\DoxyCodeLine{21 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define TWI\_SLAVE\_SEND\_SIGNAL 0x52}}
\DoxyCodeLine{26 }
\DoxyCodeLine{30 \textcolor{preprocessor}{\#define TWI\_SLAVE\_RECEIVED\_SIGNAL 0x53}}
\DoxyCodeLine{31 }
\DoxyCodeLine{35 \textcolor{keyword}{typedef} uint8\_t \mbox{\hyperlink{TwiSlave_8h_ad91b9d60e30c453fc4b5ac09b6f4a123}{twi\_frame\_t}};}
\DoxyCodeLine{36 }
\DoxyCodeLine{40 \textcolor{keyword}{typedef} uint8\_t \mbox{\hyperlink{TwiSlave_8h_ac380919adb9e45a01899199857367f7f}{twi\_address\_t}};}
\DoxyCodeLine{41 }
\DoxyCodeLine{45 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{46 }
\DoxyCodeLine{47     \textcolor{comment}{/* If master want to send data to slave */}}
\DoxyCodeLine{48     \mbox{\hyperlink{TwiSlave_8h_afa067fe80c8f6cbe72f6d46439f1cb81a68a470c9a36fab44404714c9e199bb95}{WRITE\_MODE}} = 0,}
\DoxyCodeLine{49 }
\DoxyCodeLine{50     \textcolor{comment}{/* If master want to receive data from slave */}}
\DoxyCodeLine{51     \mbox{\hyperlink{TwiSlave_8h_afa067fe80c8f6cbe72f6d46439f1cb81aa2f18143cfa252aa4deb2736e690e8d2}{READ\_MODE}} = 1}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \} \mbox{\hyperlink{TwiSlave_8h_afa067fe80c8f6cbe72f6d46439f1cb81}{twi\_transmission\_mode\_t}};}
\DoxyCodeLine{54 }
\DoxyCodeLine{58 \textcolor{keyword}{typedef} \textcolor{keyword}{enum} \{}
\DoxyCodeLine{59 }
\DoxyCodeLine{60     \textcolor{comment}{/* If TWI bas is off, or other device polled */}}
\DoxyCodeLine{61     \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beea40a067b9f249f5e6d1b1e55b667af2f5}{BUS\_OFF}} = 0,}
\DoxyCodeLine{62 }
\DoxyCodeLine{63     \textcolor{comment}{/* If TWI master polled device */}}
\DoxyCodeLine{64     \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beea3e53ce980daa48690f64a4f134446939}{VERYFI\_POLLED\_ADDRESS}} = 1,}
\DoxyCodeLine{65 }
\DoxyCodeLine{66     \textcolor{comment}{/* If slave device sending ACK to master */}}
\DoxyCodeLine{67     \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beea895e26798f794751ec25362040907eb9}{SEND\_CONFIRMATION\_TO\_MASTER}} = 2,}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \textcolor{comment}{/* If slave device receiving ACK or NACK from master */}}
\DoxyCodeLine{70     \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beeaefe5012c1c1c55aa4b3f3bee4035038c}{RECEIVE\_CONFIRMATION\_FROM\_MASTER}} = 3,}
\DoxyCodeLine{71 }
\DoxyCodeLine{72     \textcolor{comment}{/* If slave device sending data to master */}}
\DoxyCodeLine{73     \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beead5517cfca81f4033defb5eab40391b9d}{SEND\_DATA\_TO\_MASTER}} = 4,}
\DoxyCodeLine{74 }
\DoxyCodeLine{75     \textcolor{comment}{/* If slave device receiving data from master */}}
\DoxyCodeLine{76     \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beea4f30237239d595b6ffe2bcb42a53b76d}{RECEIVE\_DATA\_FROM\_MASTER}} = 5}
\DoxyCodeLine{77 }
\DoxyCodeLine{78 \} \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374bee}{twi\_state\_t}};}
\DoxyCodeLine{79 }
\DoxyCodeLine{83 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{84 }
\DoxyCodeLine{85     \textcolor{comment}{/* This is current bus state */}}
\DoxyCodeLine{86     \textcolor{keyword}{volatile} \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374bee}{twi\_state\_t}} \mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}};}
\DoxyCodeLine{87 }
\DoxyCodeLine{88     \textcolor{comment}{/* This is device address */}}
\DoxyCodeLine{89     \mbox{\hyperlink{TwiSlave_8h_ac380919adb9e45a01899199857367f7f}{twi\_address\_t}} \mbox{\hyperlink{structtwi__interface__t_afeaefc8f30845948cfa37c700c7ed730}{address}};}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{comment}{/* This is memory shared by slave device */}}
\DoxyCodeLine{92     \mbox{\hyperlink{structshared__memory__t}{shared\_memory\_t}} \mbox{\hyperlink{structtwi__interface__t_a15c5b39a658d476aff17664a80b40eee}{shared}};}
\DoxyCodeLine{93 }
\DoxyCodeLine{94 \} \mbox{\hyperlink{structtwi__interface__t}{twi\_interface\_t}};}
\DoxyCodeLine{95 }
\DoxyCodeLine{101 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{structtwi__interface__t}{twi\_interface\_t}} \mbox{\hyperlink{TwiSlave_8h_acd6ed9c131d604351eb3697b2646eef1}{create\_twi\_interface}}(\mbox{\hyperlink{TwiSlave_8h_ac380919adb9e45a01899199857367f7f}{twi\_address\_t}} address) \{}
\DoxyCodeLine{102     \textcolor{keywordflow}{return} (\mbox{\hyperlink{structtwi__interface__t}{twi\_interface\_t}}) \{}
\DoxyCodeLine{103         \mbox{\hyperlink{TwiSlave_8h_aa3bf02997a714adac2761648ef374beea40a067b9f249f5e6d1b1e55b667af2f5}{BUS\_OFF}},}
\DoxyCodeLine{104         address,}
\DoxyCodeLine{105         \mbox{\hyperlink{SharedMemory_8h_ae82a1f0facfb6fca54185c11155f70e5}{create\_shared\_memory}} ()}
\DoxyCodeLine{106     \};}
\DoxyCodeLine{107 \}}
\DoxyCodeLine{108 }
\DoxyCodeLine{114 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{TwiSlave_8h_afa067fe80c8f6cbe72f6d46439f1cb81}{twi\_transmission\_mode\_t}} \mbox{\hyperlink{TwiSlave_8h_ae9ef2f7210aaf914b4bbbd8f2ae5729c}{get\_twi\_transmission\_mode}}(}
\DoxyCodeLine{115     \mbox{\hyperlink{TwiSlave_8h_ad91b9d60e30c453fc4b5ac09b6f4a123}{twi\_frame\_t}} frame}
\DoxyCodeLine{116 ) \{}
\DoxyCodeLine{117     \textcolor{keywordflow}{return} frame \& 0x01;}
\DoxyCodeLine{118 \}}
\DoxyCodeLine{119 }
\DoxyCodeLine{124 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{TwiSlave_8h_ac380919adb9e45a01899199857367f7f}{twi\_address\_t}} \mbox{\hyperlink{TwiSlave_8h_a91eea9af7cd81d4c23faa9164fef9b5d}{get\_twi\_control\_address}} (\mbox{\hyperlink{TwiSlave_8h_ad91b9d60e30c453fc4b5ac09b6f4a123}{twi\_frame\_t}} frame) \{}
\DoxyCodeLine{125     \textcolor{keywordflow}{return} (\mbox{\hyperlink{TwiSlave_8h_ac380919adb9e45a01899199857367f7f}{twi\_address\_t}}) (frame >> 1);}
\DoxyCodeLine{126 \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{128 }
\DoxyCodeLine{129 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
