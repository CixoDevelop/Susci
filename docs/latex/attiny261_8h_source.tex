\hypertarget{attiny261_8h_source}{}\doxysection{attiny261.\+h}
\label{attiny261_8h_source}\index{susci/platforms/attiny261.h@{susci/platforms/attiny261.h}}
\mbox{\hyperlink{attiny261_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other}}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ *}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * This file stores data specific to the AVR ATtiny261 platform.}}
\DoxyCodeLine{14 \textcolor{comment}{ */}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#ifndef PLATFORMS\_ATTINY261\_H\_INCLUDED}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#define PLATFORMS\_ATTINY261\_H\_INCLUDED}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{/* Include all standard libraries for AVR */}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#include <avr/io.h>}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include <avr/interrupt.h>}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{comment}{/* Define values for this platform */}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define MAX\_SYSTEM\_TIME 65535}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define TICK\_TIME(X) (SystemTick)(X * (F\_CPU / 1000) / 1024)}}
\DoxyCodeLine{26 }
\DoxyCodeLine{27 \textcolor{keyword}{typedef} uint16\_t \mbox{\hyperlink{attiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}};}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{comment}{/* Include System plarform for override */}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include "{}../kernel/platform.h"{}}}
\DoxyCodeLine{31 }
\DoxyCodeLine{36 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{attiny261_8h_a1f4227a7bd0a5e9386fabfe7d58a7183}{platform\_init}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{37     \textcolor{comment}{/* Run timer in 16 bit mode */}}
\DoxyCodeLine{38     TCCR0A = (1 << TCW0);}
\DoxyCodeLine{39 }
\DoxyCodeLine{40     \textcolor{comment}{/* And F\_CPU / 1024 Hz frequency */}}
\DoxyCodeLine{41     TCCR0B = (1 << CS02) | (1 << CS00);}
\DoxyCodeLine{42 \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{48 \textcolor{keyword}{static} \mbox{\hyperlink{attiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} \mbox{\hyperlink{attiny261_8h_a2573781dcdeb21b82f54574ae060be82}{get\_time}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{49     \textcolor{comment}{/* Run this opetation atomic */}}
\DoxyCodeLine{50     uint8\_t sreg = SREG;}
\DoxyCodeLine{51 }
\DoxyCodeLine{52     cli ();}
\DoxyCodeLine{53     }
\DoxyCodeLine{54     \mbox{\hyperlink{attiny261_8h_ae82a0396b3e81a46cd59bbe0d98089b8}{system\_tick\_t}} current\_time = TCNT0L;}
\DoxyCodeLine{55     current\_time  |= ((uint8\_t) TCNT0H << 8);}
\DoxyCodeLine{56 }
\DoxyCodeLine{57     SREG = sreg;}
\DoxyCodeLine{58 }
\DoxyCodeLine{59     \textcolor{keywordflow}{return} current\_time;}
\DoxyCodeLine{60 \}}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \textcolor{preprocessor}{\#define LOW\_DDR \&DDRB}}
\DoxyCodeLine{63 \textcolor{preprocessor}{\#define LOW\_PIN \&PINB}}
\DoxyCodeLine{64 \textcolor{preprocessor}{\#define LOW\_PORT \&PORTB}}
\DoxyCodeLine{65 \textcolor{preprocessor}{\#define LOW\_PCMSK \&PCMSK1}}
\DoxyCodeLine{66 }
\DoxyCodeLine{67 \textcolor{preprocessor}{\#ifdef DIP\_LAYOUT}}
\DoxyCodeLine{68 \textcolor{preprocessor}{\#define PIN\_1 0}}
\DoxyCodeLine{69 \textcolor{preprocessor}{\#define PIN\_2 1}}
\DoxyCodeLine{70 \textcolor{preprocessor}{\#define PIN\_3 2}}
\DoxyCodeLine{71 \textcolor{preprocessor}{\#define PIN\_4 3}}
\DoxyCodeLine{72 \textcolor{preprocessor}{\#define PIN\_5 ERROR\_VCC}}
\DoxyCodeLine{73 \textcolor{preprocessor}{\#define PIN\_6 ERROR\_GND}}
\DoxyCodeLine{74 \textcolor{preprocessor}{\#define PIN\_7 4}}
\DoxyCodeLine{75 \textcolor{preprocessor}{\#define PIN\_8 5}}
\DoxyCodeLine{76 \textcolor{preprocessor}{\#define PIN\_9 6}}
\DoxyCodeLine{77 \textcolor{preprocessor}{\#define PIN\_10 7}}
\DoxyCodeLine{78 \textcolor{preprocessor}{\#define PIN\_11 15}}
\DoxyCodeLine{79 \textcolor{preprocessor}{\#define PIN\_12 14}}
\DoxyCodeLine{80 \textcolor{preprocessor}{\#define PIN\_13 13}}
\DoxyCodeLine{81 \textcolor{preprocessor}{\#define PIN\_14 12}}
\DoxyCodeLine{82 \textcolor{preprocessor}{\#define PIN\_15 ERROR\_AVCC}}
\DoxyCodeLine{83 \textcolor{preprocessor}{\#define PIN\_16 ERROR\_GND}}
\DoxyCodeLine{84 \textcolor{preprocessor}{\#define PIN\_17 11}}
\DoxyCodeLine{85 \textcolor{preprocessor}{\#define PIN\_18 10}}
\DoxyCodeLine{86 \textcolor{preprocessor}{\#define PIN\_19 9}}
\DoxyCodeLine{87 \textcolor{preprocessor}{\#define PIN\_20 8}}
\DoxyCodeLine{88 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{preprocessor}{\#include "{}../drivers/integrated/avr\_pins.h"{}}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \textcolor{preprocessor}{\#define BYTE\_EEPROM\_ADDRESS}}
\DoxyCodeLine{93 \textcolor{preprocessor}{\#include "{}../drivers/integrated/avr\_storage.h"{}}}
\DoxyCodeLine{94 }
\DoxyCodeLine{95 \textcolor{comment}{/* Catch bad ISR so no reset occurs */}}
\DoxyCodeLine{96 \mbox{\hyperlink{attiny261_8h_a04d3f94da90f7ac1b018f80f321e86de}{ISR}} (BADISR\_vect) \{\}}
\DoxyCodeLine{97 }
\DoxyCodeLine{98 \textcolor{preprocessor}{\#ifdef USE\_PINCHANGE\_INTERRUPT}}
\DoxyCodeLine{99 \textcolor{preprocessor}{\#define PINCHANGE\_INTERRUPT\_AVR}}
\DoxyCodeLine{100 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{101 }
\DoxyCodeLine{102 \textcolor{preprocessor}{\#ifdef USE\_TWI\_SLAVE}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104 \textcolor{preprocessor}{\#define USI\_DATA USIDR}}
\DoxyCodeLine{105 \textcolor{preprocessor}{\#define USI\_CONTROL USICR}}
\DoxyCodeLine{106 \textcolor{preprocessor}{\#define USI\_STATUS USISR}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108 \textcolor{preprocessor}{\#define SDA\_PIN PINB}}
\DoxyCodeLine{109 \textcolor{preprocessor}{\#define SDA\_PORT PORTB}}
\DoxyCodeLine{110 \textcolor{preprocessor}{\#define SDA\_DDR DDRB}}
\DoxyCodeLine{111 \textcolor{preprocessor}{\#define SDA\_MASK \_BV (0)}}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \textcolor{preprocessor}{\#define SCL\_PIN PINB}}
\DoxyCodeLine{114 \textcolor{preprocessor}{\#define SCL\_PORT PORTB}}
\DoxyCodeLine{115 \textcolor{preprocessor}{\#define SCL\_DDR DDRB}}
\DoxyCodeLine{116 \textcolor{preprocessor}{\#define SCL\_MASK \_BV (2)}}
\DoxyCodeLine{117 }
\DoxyCodeLine{118 \textcolor{preprocessor}{\#define USI\_START\_INTERRUPT USI\_START\_vect}}
\DoxyCodeLine{119 \textcolor{preprocessor}{\#define USI\_OVERFLOW\_INTERRUPT USI\_OVF\_vect}}
\DoxyCodeLine{120 }
\DoxyCodeLine{121 \textcolor{preprocessor}{\#define USE\_TWI\_SLAVE\_TINY\_IMPLEMENTATION}}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{124 }
\DoxyCodeLine{125 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
