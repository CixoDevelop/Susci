\hypertarget{tiny__twi__slave_8h_source}{}\doxysection{tiny\+\_\+twi\+\_\+slave.\+h}
\label{tiny__twi__slave_8h_source}\index{susci/drivers/integrated/tiny\_twi\_slave.h@{susci/drivers/integrated/tiny\_twi\_slave.h}}
\mbox{\hyperlink{tiny__twi__slave_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other}}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ * Inspired by the CalcProgrammer1 project:}}
\DoxyCodeLine{12 \textcolor{comment}{ * + https://instructables.com/ATTiny-\/USI-\/I2C-\/The-\/detailed-\/in-\/depth-\/and-\/infor}}
\DoxyCodeLine{13 \textcolor{comment}{ *}}
\DoxyCodeLine{14 \textcolor{comment}{ *}}
\DoxyCodeLine{15 \textcolor{comment}{ * This file stores the TwiSlave driver running via the USI device available}}
\DoxyCodeLine{16 \textcolor{comment}{ * instead of the hardware TWI in the smaller AtTiny microcontrollers. During}}
\DoxyCodeLine{17 \textcolor{comment}{ * development, I used the CalcProgrammer1 project and the AVR312 document.}}
\DoxyCodeLine{18 \textcolor{comment}{ * The code is heavily based on the CalcProgrammer1 project, but I decided to}}
\DoxyCodeLine{19 \textcolor{comment}{ * redesign it a bit to better fit Susci.}}
\DoxyCodeLine{20 \textcolor{comment}{ */}}
\DoxyCodeLine{21 }
\DoxyCodeLine{22 \textcolor{preprocessor}{\#ifndef DRIVERS\_INTEGRATED\_TINY\_TWI\_SLAVE\_H\_INCLUDED}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#define DRIVERS\_INTEGRATED\_TINY\_TWI\_SLAVE\_H\_INCLUDED}}
\DoxyCodeLine{24 }
\DoxyCodeLine{25 \textcolor{preprocessor}{\#define USI\_ACK\_DATA 0x00}}
\DoxyCodeLine{26 }
\DoxyCodeLine{30 \mbox{\hyperlink{structtwi__interface__t}{twi\_interface\_t}} \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}};}
\DoxyCodeLine{31 }
\DoxyCodeLine{35 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a24f8e3f96580583e7a51fb90480764ba}{usi\_twi\_set\_input}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{36     SDA\_DDR \&= \string~SDA\_MASK;}
\DoxyCodeLine{37 \}}
\DoxyCodeLine{38 }
\DoxyCodeLine{43 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a6418fbe786d37c875be190bcb98895f5}{usi\_twi\_set\_output}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{44     SDA\_DDR |= SDA\_MASK;}
\DoxyCodeLine{45 \}}
\DoxyCodeLine{46 }
\DoxyCodeLine{52 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a786cb3d9d1346f65a19bf357140f71ba}{usi\_twi\_set\_data\_output}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{53     SDA\_PORT |= SDA\_MASK;}
\DoxyCodeLine{54 \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{60 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a99de4a4108f7c0ae51bdfeead385a800}{usi\_twi\_set\_data\_input}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{61     SDA\_PORT \&= \string~SDA\_MASK;}
\DoxyCodeLine{62 \}}
\DoxyCodeLine{63 }
\DoxyCodeLine{67 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a2753474b16920ab5b497d34d722fe58b}{usi\_twi\_set\_port}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{68     SDA\_DDR \&= \string~SDA\_MASK;}
\DoxyCodeLine{69     SDA\_PORT \&= \string~SDA\_MASK;}
\DoxyCodeLine{70 }
\DoxyCodeLine{71     SCL\_DDR \&= \string~SCL\_MASK;}
\DoxyCodeLine{72     SCL\_PORT \&= \string~SCL\_MASK;}
\DoxyCodeLine{73 \}}
\DoxyCodeLine{74 }
\DoxyCodeLine{80 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{tiny__twi__slave_8h_a3aa731926e87517a9defea0a5beba373}{usi\_twi\_wait\_for\_start\_stop}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{81     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{bool}) (SCL\_PIN \& SCL\_MASK) \&\& !(SDA\_PIN \& SDA\_MASK);}
\DoxyCodeLine{82 \}}
\DoxyCodeLine{83 }
\DoxyCodeLine{87 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{bool} \mbox{\hyperlink{tiny__twi__slave_8h_a340509d0973429159f048ae0f38220f7}{usi\_twi\_stop\_come}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{88     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{bool}) (SDA\_PIN \& SDA\_MASK);}
\DoxyCodeLine{89 \}}
\DoxyCodeLine{90 }
\DoxyCodeLine{95 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a47772e6f29c984cbf6068a2dbbfae726}{usi\_twi\_setup\_control\_stop}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{96     USI\_CONTROL =}
\DoxyCodeLine{97             (1 << USISIE) |}
\DoxyCodeLine{98             (0 << USIOIE) |}
\DoxyCodeLine{99             (1 << USIWM1) |}
\DoxyCodeLine{100             (1 << USIWM0) |}
\DoxyCodeLine{101             (1 << USICS1) |}
\DoxyCodeLine{102             (0 << USICS0) |}
\DoxyCodeLine{103             (0 << USICLK) |}
\DoxyCodeLine{104             (0 << USITC);}
\DoxyCodeLine{105 \}}
\DoxyCodeLine{106 }
\DoxyCodeLine{111 \textcolor{keyword}{inline} \textcolor{keyword}{static} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a386345ca0ee15d80c376e10edbf62abb}{usi\_twi\_setup\_control\_start}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{112     USI\_CONTROL =}
\DoxyCodeLine{113             (1 << USISIE) |}
\DoxyCodeLine{114             (1 << USIOIE) |}
\DoxyCodeLine{115             (1 << USIWM1) |}
\DoxyCodeLine{116             (0 << USIWM0) |}
\DoxyCodeLine{117             (1 << USICS1) |}
\DoxyCodeLine{118             (0 << USICS0) |}
\DoxyCodeLine{119             (0 << USICLK) |}
\DoxyCodeLine{120             (0 << USITC);}
\DoxyCodeLine{121 \}}
\DoxyCodeLine{122 }
\DoxyCodeLine{127 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a13fc3dc6bbbadf7b856909a49c03ed82}{usi\_twi\_setup\_counter\_start}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{128     USI\_STATUS =}
\DoxyCodeLine{129         (1 << USISIF) |}
\DoxyCodeLine{130         (1 << USIOIF) |}
\DoxyCodeLine{131         (1 << USIPF) |}
\DoxyCodeLine{132         (1 << USIDC) |}
\DoxyCodeLine{133         (0x00 << USICNT0);}
\DoxyCodeLine{134 \}}
\DoxyCodeLine{135 }
\DoxyCodeLine{141 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a765eb4d324fb081c750602100e192e2b}{usi\_twi\_setup\_counter\_byte}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{142     USI\_STATUS =}
\DoxyCodeLine{143         (0 << USISIF) |}
\DoxyCodeLine{144         (1 << USIOIF) |}
\DoxyCodeLine{145         (1 << USIPF) |}
\DoxyCodeLine{146         (1 << USIDC) |}
\DoxyCodeLine{147         (0x00 << USICNT0);}
\DoxyCodeLine{148 \}}
\DoxyCodeLine{149 }
\DoxyCodeLine{154 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_aed25b35f7724b86bc2134b15516ac2ab}{usi\_twi\_setup\_counter\_bit}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{155     USI\_STATUS =}
\DoxyCodeLine{156         (0 << USISIF) |}
\DoxyCodeLine{157         (1 << USIOIF) |}
\DoxyCodeLine{158         (1 << USIPF) |}
\DoxyCodeLine{159         (1 << USIDC) |}
\DoxyCodeLine{160         (0x0E << USICNT0);}
\DoxyCodeLine{161 \}}
\DoxyCodeLine{162 }
\DoxyCodeLine{166 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_af675c078a3970cf3c0bfd5ff05b0aa60}{usi\_twi\_send\_confirmation}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{167     USI\_DATA = \mbox{\hyperlink{tiny__twi__slave_8h_af37a746830fae7be9ee06ecdb0c4a894}{USI\_ACK\_DATA}};}
\DoxyCodeLine{168     }
\DoxyCodeLine{169     \mbox{\hyperlink{tiny__twi__slave_8h_a6418fbe786d37c875be190bcb98895f5}{usi\_twi\_set\_output}}();}
\DoxyCodeLine{170     \mbox{\hyperlink{tiny__twi__slave_8h_aed25b35f7724b86bc2134b15516ac2ab}{usi\_twi\_setup\_counter\_bit}}();}
\DoxyCodeLine{171 \}}
\DoxyCodeLine{172 }
\DoxyCodeLine{176 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} \mbox{\hyperlink{tiny__twi__slave_8h_a9bca213db093c25ab0cd299e26efa5f0}{usi\_twi\_enable}}(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{177     \mbox{\hyperlink{tiny__twi__slave_8h_a2753474b16920ab5b497d34d722fe58b}{usi\_twi\_set\_port}}();}
\DoxyCodeLine{178 }
\DoxyCodeLine{179     \mbox{\hyperlink{tiny__twi__slave_8h_a386345ca0ee15d80c376e10edbf62abb}{usi\_twi\_setup\_control\_start}}();}
\DoxyCodeLine{180     \mbox{\hyperlink{tiny__twi__slave_8h_a13fc3dc6bbbadf7b856909a49c03ed82}{usi\_twi\_setup\_counter\_start}}();}
\DoxyCodeLine{181 }
\DoxyCodeLine{182     sei();}
\DoxyCodeLine{183 \}}
\DoxyCodeLine{184 }
\DoxyCodeLine{189 \mbox{\hyperlink{tiny__twi__slave_8h_accf18beea8ea5ee677d25d0770151da8}{ISR}} (USI\_START\_INTERRUPT) \{}
\DoxyCodeLine{190     \mbox{\hyperlink{tiny__twi__slave_8h_a24f8e3f96580583e7a51fb90480764ba}{usi\_twi\_set\_input}}();}
\DoxyCodeLine{191 }
\DoxyCodeLine{192     \textcolor{keywordflow}{while} (\mbox{\hyperlink{tiny__twi__slave_8h_a3aa731926e87517a9defea0a5beba373}{usi\_twi\_wait\_for\_start\_stop}}()) ;}
\DoxyCodeLine{193 }
\DoxyCodeLine{194     \textcolor{keywordflow}{if} (\mbox{\hyperlink{tiny__twi__slave_8h_a340509d0973429159f048ae0f38220f7}{usi\_twi\_stop\_come}}()) \mbox{\hyperlink{tiny__twi__slave_8h_a47772e6f29c984cbf6068a2dbbfae726}{usi\_twi\_setup\_control\_stop}}();}
\DoxyCodeLine{195     \textcolor{keywordflow}{else} \mbox{\hyperlink{tiny__twi__slave_8h_a386345ca0ee15d80c376e10edbf62abb}{usi\_twi\_setup\_control\_start}}();}
\DoxyCodeLine{196 }
\DoxyCodeLine{197     \mbox{\hyperlink{tiny__twi__slave_8h_a13fc3dc6bbbadf7b856909a49c03ed82}{usi\_twi\_setup\_counter\_start}}();}
\DoxyCodeLine{198     \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea3e53ce980daa48690f64a4f134446939}{VERYFI\_POLLED\_ADDRESS}};}
\DoxyCodeLine{199 \}}
\DoxyCodeLine{200 }
\DoxyCodeLine{206 \mbox{\hyperlink{tiny__twi__slave_8h_accf18beea8ea5ee677d25d0770151da8}{ISR}} (USI\_OVERFLOW\_INTERRUPT) \{}
\DoxyCodeLine{207     \mbox{\hyperlink{twi__slave_8h_ad91b9d60e30c453fc4b5ac09b6f4a123}{twi\_frame\_t}} buffer = USI\_DATA;}
\DoxyCodeLine{208 }
\DoxyCodeLine{209     \textcolor{keywordflow}{switch} (\mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}}) \{}
\DoxyCodeLine{210 }
\DoxyCodeLine{211         \textcolor{keywordflow}{case} \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea40a067b9f249f5e6d1b1e55b667af2f5}{BUS\_OFF}}: ;}
\DoxyCodeLine{212         \textcolor{keywordflow}{break};}
\DoxyCodeLine{213 }
\DoxyCodeLine{214         \textcolor{keywordflow}{case} \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea3e53ce980daa48690f64a4f134446939}{VERYFI\_POLLED\_ADDRESS}}: ;}
\DoxyCodeLine{215 }
\DoxyCodeLine{216             \textcolor{comment}{/*}}
\DoxyCodeLine{217 \textcolor{comment}{             * If polled address is not this device address, turn off}}
\DoxyCodeLine{218 \textcolor{comment}{             * processing data, and come back}}
\DoxyCodeLine{219 \textcolor{comment}{             */}}
\DoxyCodeLine{220             \textcolor{keywordflow}{if} (\mbox{\hyperlink{twi__slave_8h_a91eea9af7cd81d4c23faa9164fef9b5d}{get\_twi\_control\_address}}(buffer) != \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_afeaefc8f30845948cfa37c700c7ed730}{address}}) \{}
\DoxyCodeLine{221                 \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea40a067b9f249f5e6d1b1e55b667af2f5}{BUS\_OFF}};}
\DoxyCodeLine{222                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{223             \}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225             \mbox{\hyperlink{tiny__twi__slave_8h_af675c078a3970cf3c0bfd5ff05b0aa60}{usi\_twi\_send\_confirmation}}();}
\DoxyCodeLine{226 }
\DoxyCodeLine{227             \textcolor{comment}{/*}}
\DoxyCodeLine{228 \textcolor{comment}{             * If master want to write data to slave, prepare USI device to}}
\DoxyCodeLine{229 \textcolor{comment}{             * to receive data, if master want to receive data, prepare to}}
\DoxyCodeLine{230 \textcolor{comment}{             * send data.}}
\DoxyCodeLine{231 \textcolor{comment}{             */}}
\DoxyCodeLine{232             \textcolor{keywordflow}{if} (\mbox{\hyperlink{twi__slave_8h_ae9ef2f7210aaf914b4bbbd8f2ae5729c}{get\_twi\_transmission\_mode}}(buffer) == \mbox{\hyperlink{twi__slave_8h_afa067fe80c8f6cbe72f6d46439f1cb81a68a470c9a36fab44404714c9e199bb95}{WRITE\_MODE}}) \{}
\DoxyCodeLine{233                 \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea4f30237239d595b6ffe2bcb42a53b76d}{RECEIVE\_DATA\_FROM\_MASTER}};}
\DoxyCodeLine{234                 \mbox{\hyperlink{shared__memory_8h_add8b13852d06f764e58738c763fe8695}{reset\_shared\_memory\_pointer}}(\&\mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_a15c5b39a658d476aff17664a80b40eee}{shared}});}
\DoxyCodeLine{235             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{236                 \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beead5517cfca81f4033defb5eab40391b9d}{SEND\_DATA\_TO\_MASTER}};}
\DoxyCodeLine{237             \}}
\DoxyCodeLine{238 }
\DoxyCodeLine{239         \textcolor{keywordflow}{break};}
\DoxyCodeLine{240 }
\DoxyCodeLine{241         \textcolor{keywordflow}{case} \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea895e26798f794751ec25362040907eb9}{SEND\_CONFIRMATION\_TO\_MASTER}}: ;}
\DoxyCodeLine{242 }
\DoxyCodeLine{243             \mbox{\hyperlink{tiny__twi__slave_8h_af675c078a3970cf3c0bfd5ff05b0aa60}{usi\_twi\_send\_confirmation}}();}
\DoxyCodeLine{244 }
\DoxyCodeLine{245             \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea4f30237239d595b6ffe2bcb42a53b76d}{RECEIVE\_DATA\_FROM\_MASTER}};}
\DoxyCodeLine{246 }
\DoxyCodeLine{247             \textcolor{comment}{/*}}
\DoxyCodeLine{248 \textcolor{comment}{             * If pointer in memory has been set, write received data to}}
\DoxyCodeLine{249 \textcolor{comment}{             *  memory and trigger signal, else received data is pointer.}}
\DoxyCodeLine{250 \textcolor{comment}{             */}}
\DoxyCodeLine{251             \textcolor{keywordflow}{if} (\mbox{\hyperlink{shared__memory_8h_a2855e388d05bf9428d4760346e0d4321}{is\_set\_shared\_memory\_pointer}}(\&\mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_a15c5b39a658d476aff17664a80b40eee}{shared}}))\{}
\DoxyCodeLine{252                 \mbox{\hyperlink{shared__memory_8h_a6a235bd8a8017c2f9cc13030c0dcd5b1}{write\_shared\_memory}}(\&\mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_a15c5b39a658d476aff17664a80b40eee}{shared}}, buffer);}
\DoxyCodeLine{253                 \mbox{\hyperlink{interface_8h_a9170dd6b2979b456395c39bbfdbf9a84}{make\_signal}}(\mbox{\hyperlink{twi__slave_8h_a2a48d07497b7b3f48d6c58161a7fd496}{TWI\_SLAVE\_RECEIVED\_SIGNAL}});}
\DoxyCodeLine{254             \}\textcolor{keywordflow}{else}\{}
\DoxyCodeLine{255                 \mbox{\hyperlink{shared__memory_8h_a286a0bfa7dda06dff22eeaf8657ca9bb}{set\_shared\_memory\_pointer}}(\&\mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_a15c5b39a658d476aff17664a80b40eee}{shared}}, buffer);}
\DoxyCodeLine{256             \}}
\DoxyCodeLine{257 }
\DoxyCodeLine{258         \textcolor{keywordflow}{break};}
\DoxyCodeLine{259 }
\DoxyCodeLine{260         \textcolor{keywordflow}{case} \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beeaefe5012c1c1c55aa4b3f3bee4035038c}{RECEIVE\_CONFIRMATION\_FROM\_MASTER}}: ;}
\DoxyCodeLine{261 }
\DoxyCodeLine{262             \mbox{\hyperlink{tiny__twi__slave_8h_a24f8e3f96580583e7a51fb90480764ba}{usi\_twi\_set\_input}}();}
\DoxyCodeLine{263             \mbox{\hyperlink{tiny__twi__slave_8h_a99de4a4108f7c0ae51bdfeead385a800}{usi\_twi\_set\_data\_input}}();}
\DoxyCodeLine{264 }
\DoxyCodeLine{265             USI\_DATA = 0x00;}
\DoxyCodeLine{266 }
\DoxyCodeLine{267             \mbox{\hyperlink{tiny__twi__slave_8h_aed25b35f7724b86bc2134b15516ac2ab}{usi\_twi\_setup\_counter\_bit}}();}
\DoxyCodeLine{268 }
\DoxyCodeLine{269             \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beead5517cfca81f4033defb5eab40391b9d}{SEND\_DATA\_TO\_MASTER}};}
\DoxyCodeLine{270 }
\DoxyCodeLine{271         \textcolor{keywordflow}{break};}
\DoxyCodeLine{272 }
\DoxyCodeLine{273         \textcolor{keywordflow}{case} \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beead5517cfca81f4033defb5eab40391b9d}{SEND\_DATA\_TO\_MASTER}}: ;}
\DoxyCodeLine{274 }
\DoxyCodeLine{275             \textcolor{comment}{/*}}
\DoxyCodeLine{276 \textcolor{comment}{             * Check received confirmation. If master send NACK this is end of}}
\DoxyCodeLine{277 \textcolor{comment}{             * transmission, turn off bus and come back.}}
\DoxyCodeLine{278 \textcolor{comment}{             */}}
\DoxyCodeLine{279             \textcolor{keywordflow}{if} (buffer != 0x00) \{}
\DoxyCodeLine{280                 \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea40a067b9f249f5e6d1b1e55b667af2f5}{BUS\_OFF}};}
\DoxyCodeLine{281                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{282             \}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284             \mbox{\hyperlink{tiny__twi__slave_8h_a6418fbe786d37c875be190bcb98895f5}{usi\_twi\_set\_output}}();}
\DoxyCodeLine{285             \mbox{\hyperlink{tiny__twi__slave_8h_a786cb3d9d1346f65a19bf357140f71ba}{usi\_twi\_set\_data\_output}}();}
\DoxyCodeLine{286 }
\DoxyCodeLine{287             USI\_DATA = \mbox{\hyperlink{shared__memory_8h_a641411dcbf897fcf7532b0eb45031f7a}{read\_shared\_memory}}(\&\mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_a15c5b39a658d476aff17664a80b40eee}{shared}});}
\DoxyCodeLine{288 }
\DoxyCodeLine{289             \mbox{\hyperlink{tiny__twi__slave_8h_a765eb4d324fb081c750602100e192e2b}{usi\_twi\_setup\_counter\_byte}}();}
\DoxyCodeLine{290 }
\DoxyCodeLine{291             \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beeaefe5012c1c1c55aa4b3f3bee4035038c}{RECEIVE\_CONFIRMATION\_FROM\_MASTER}};}
\DoxyCodeLine{292 }
\DoxyCodeLine{293             \mbox{\hyperlink{interface_8h_a9170dd6b2979b456395c39bbfdbf9a84}{make\_signal}}(\mbox{\hyperlink{twi__slave_8h_a31fc5d7cb272f3882a457d8773cd99d2}{TWI\_SLAVE\_SEND\_SIGNAL}});}
\DoxyCodeLine{294 }
\DoxyCodeLine{295         \textcolor{keywordflow}{break};}
\DoxyCodeLine{296 }
\DoxyCodeLine{297         \textcolor{keywordflow}{case} \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea4f30237239d595b6ffe2bcb42a53b76d}{RECEIVE\_DATA\_FROM\_MASTER}}: ;}
\DoxyCodeLine{298 }
\DoxyCodeLine{299             \mbox{\hyperlink{tiny__twi__slave_8h_a24f8e3f96580583e7a51fb90480764ba}{usi\_twi\_set\_input}}();}
\DoxyCodeLine{300 }
\DoxyCodeLine{301             \mbox{\hyperlink{tiny__twi__slave_8h_a765eb4d324fb081c750602100e192e2b}{usi\_twi\_setup\_counter\_byte}}();}
\DoxyCodeLine{302 }
\DoxyCodeLine{303             \mbox{\hyperlink{tiny__twi__slave_8h_a9760a5c16b836eeac885e7f5f10f64b0}{twi\_slave}}.\mbox{\hyperlink{structtwi__interface__t_af7a45e24260277ba0082e70078e04de3}{state}} = \mbox{\hyperlink{twi__slave_8h_aa3bf02997a714adac2761648ef374beea895e26798f794751ec25362040907eb9}{SEND\_CONFIRMATION\_TO\_MASTER}};}
\DoxyCodeLine{304 }
\DoxyCodeLine{305         \textcolor{keywordflow}{break};}
\DoxyCodeLine{306 }
\DoxyCodeLine{307         \textcolor{keywordflow}{default}: ;}
\DoxyCodeLine{308         \textcolor{keywordflow}{break};}
\DoxyCodeLine{309     \}}
\DoxyCodeLine{310 \}}
\DoxyCodeLine{311 }
\DoxyCodeLine{312 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
