\hypertarget{ShiftRegister_8h_source}{}\doxysection{Shift\+Register.\+h}
\label{ShiftRegister_8h_source}\index{Susci/Drivers/Register/ShiftRegister.h@{Susci/Drivers/Register/ShiftRegister.h}}
\mbox{\hyperlink{ShiftRegister_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/*}}
\DoxyCodeLine{2 \textcolor{comment}{ * This file is part of the Susci project, an ultra lightweight general purpose}}
\DoxyCodeLine{3 \textcolor{comment}{ * operating system aimed at devices without an MMU module and with very little}}
\DoxyCodeLine{4 \textcolor{comment}{ * RAM memory.}}
\DoxyCodeLine{5 \textcolor{comment}{ *}}
\DoxyCodeLine{6 \textcolor{comment}{ * It is released under the terms of the MIT license, you can use Susca in your}}
\DoxyCodeLine{7 \textcolor{comment}{ * projects, you just need to mention it in the documentation, manual or other}}
\DoxyCodeLine{8 \textcolor{comment}{ * such place.}}
\DoxyCodeLine{9 \textcolor{comment}{ *}}
\DoxyCodeLine{10 \textcolor{comment}{ * Author: Cixo}}
\DoxyCodeLine{11 \textcolor{comment}{ *}}
\DoxyCodeLine{12 \textcolor{comment}{ *}}
\DoxyCodeLine{13 \textcolor{comment}{ * This file stores driver who is responsible for managment shift registers. }}
\DoxyCodeLine{14 \textcolor{comment}{ * This has driver that is standard Susci service for sending data to }}
\DoxyCodeLine{15 \textcolor{comment}{ * register hardware.}}
\DoxyCodeLine{16 \textcolor{comment}{ */}}
\DoxyCodeLine{17 }
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{preprocessor}{\#ifndef DRIVERS\_REGISTER\_SHIFT\_REGISTER\_H\_INCLUDED}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define DRIVERS\_REGISTER\_SHIFT\_REGISTER\_H\_INCLUDED}}
\DoxyCodeLine{21 }
\DoxyCodeLine{25 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{26 }
\DoxyCodeLine{27     \textcolor{comment}{/* For sending new data to register */}}
\DoxyCodeLine{28     \mbox{\hyperlink{structlatch__t}{latch\_t}} \mbox{\hyperlink{structshift__register__t_a8580531b3ac6660af3b447edfdb7bb0d}{latch}};}
\DoxyCodeLine{29     }
\DoxyCodeLine{30     \textcolor{comment}{/* For storing pins */}}
\DoxyCodeLine{31     \mbox{\hyperlink{AvrPins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} \mbox{\hyperlink{structshift__register__t_adb4652a86c2fd2a6853f782b7e93a4f6}{da}};}
\DoxyCodeLine{32     \mbox{\hyperlink{AvrPins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} \mbox{\hyperlink{structshift__register__t_ab4fab70ae11f7521d730e67ab2b31552}{st\_cp}};}
\DoxyCodeLine{33     \mbox{\hyperlink{AvrPins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} \mbox{\hyperlink{structshift__register__t_aea8bf2b8dc645d75a480b879e3260b07}{sh\_cp}};}
\DoxyCodeLine{34 }
\DoxyCodeLine{35 \} \mbox{\hyperlink{structshift__register__t}{shift\_register\_t}};}
\DoxyCodeLine{36 }
\DoxyCodeLine{43 \textcolor{keyword}{static} \textcolor{keyword}{inline} \mbox{\hyperlink{structshift__register__t}{shift\_register\_t}} \mbox{\hyperlink{ShiftRegister_8h_ac88781cc39ca294aad9c66310d7b9abc}{createShiftRegister}}(}
\DoxyCodeLine{44     \mbox{\hyperlink{AvrPins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} da, }
\DoxyCodeLine{45     \mbox{\hyperlink{AvrPins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} st\_cp, }
\DoxyCodeLine{46     \mbox{\hyperlink{AvrPins_8h_aede467d93ddeb5fdeff6023236aa4ad6}{pin\_t}} sh\_cp}
\DoxyCodeLine{47 ) \{}
\DoxyCodeLine{48     \textcolor{comment}{/* Set pins as outputs and low state */}}
\DoxyCodeLine{49     uint8\_t da\_mask = \mbox{\hyperlink{AvrPins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(da);}
\DoxyCodeLine{50     uint8\_t st\_cp\_mask = \mbox{\hyperlink{AvrPins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(st\_cp);}
\DoxyCodeLine{51     uint8\_t sh\_cp\_mask = \mbox{\hyperlink{AvrPins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(sh\_cp);}
\DoxyCodeLine{52 }
\DoxyCodeLine{53     *\mbox{\hyperlink{AvrPins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(da) \&= \string~da\_mask;}
\DoxyCodeLine{54     *\mbox{\hyperlink{AvrPins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(st\_cp) \&= \string~st\_cp\_mask;}
\DoxyCodeLine{55     *\mbox{\hyperlink{AvrPins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(sh\_cp) \&= \string~sh\_cp\_mask;}
\DoxyCodeLine{56 }
\DoxyCodeLine{57     *\mbox{\hyperlink{AvrPins_8h_aea7ebd8a4464d1fd954e3ba1363932a8}{create\_pin\_direction\_pointer}}(da) |= da\_mask;}
\DoxyCodeLine{58     *\mbox{\hyperlink{AvrPins_8h_aea7ebd8a4464d1fd954e3ba1363932a8}{create\_pin\_direction\_pointer}}(st\_cp) |= st\_cp\_mask;}
\DoxyCodeLine{59     *\mbox{\hyperlink{AvrPins_8h_aea7ebd8a4464d1fd954e3ba1363932a8}{create\_pin\_direction\_pointer}}(sh\_cp) |= sh\_cp\_mask;}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{comment}{/* New object */}}
\DoxyCodeLine{62     \textcolor{keywordflow}{return} (\mbox{\hyperlink{structshift__register__t}{shift\_register\_t}}) \{\mbox{\hyperlink{Latch_8h_ab92f0b12401b52dd993da5d5b35f3f12}{create\_latch}}(), da, st\_cp, sh\_cp\};}
\DoxyCodeLine{63 \}}
\DoxyCodeLine{64 }
\DoxyCodeLine{69 \textcolor{keyword}{static} \mbox{\hyperlink{Process_8h_aeccc645031be90ded0759d4192ce2a97}{exec\_state\_t}} \mbox{\hyperlink{ShiftRegister_8h_a3bd68e283263926f4240492bbb93bcf7}{shift\_register\_driver}}(\textcolor{keywordtype}{void} *shift\_register\_pointer) \{}
\DoxyCodeLine{70     \textcolor{comment}{/*}}
\DoxyCodeLine{71 \textcolor{comment}{     * First check data in latch, if data is empty, return idle state, next}}
\DoxyCodeLine{72 \textcolor{comment}{     * send all 8 bits to shift register. On end commit on latch.}}
\DoxyCodeLine{73 \textcolor{comment}{     */}}
\DoxyCodeLine{74     \mbox{\hyperlink{structshift__register__t}{shift\_register\_t}} *shift\_register = shift\_register\_pointer;}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     \textcolor{keywordflow}{if} (\mbox{\hyperlink{Latch_8h_ac3a79e947e5833e73f4647821409e3ce}{get\_latch\_busy\_flag}}(\&shift\_register-\/>\mbox{\hyperlink{structshift__register__t_a8580531b3ac6660af3b447edfdb7bb0d}{latch}}) == \mbox{\hyperlink{Latch_8h_a4645d494e6fbaa3789d7362fc731ba93aa7a51864855a71fcbf553da33d217a07}{EMPTY\_FLAG}}) \{}
\DoxyCodeLine{77         \textcolor{keywordflow}{return} \mbox{\hyperlink{Process_8h_aeccc645031be90ded0759d4192ce2a97aeca4500f6f729608a014643f8c8f4003}{IDLE\_STATE}};}
\DoxyCodeLine{78     \}}
\DoxyCodeLine{79 }
\DoxyCodeLine{80     \textcolor{keyword}{volatile} uint8\_t *da\_output = \mbox{\hyperlink{AvrPins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(}
\DoxyCodeLine{81         shift\_register-\/>\mbox{\hyperlink{structshift__register__t_adb4652a86c2fd2a6853f782b7e93a4f6}{da}}}
\DoxyCodeLine{82     );}
\DoxyCodeLine{83     \textcolor{keyword}{volatile} uint8\_t *st\_cp\_output = \mbox{\hyperlink{AvrPins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(}
\DoxyCodeLine{84         shift\_register-\/>\mbox{\hyperlink{structshift__register__t_ab4fab70ae11f7521d730e67ab2b31552}{st\_cp}}}
\DoxyCodeLine{85     );}
\DoxyCodeLine{86     \textcolor{keyword}{volatile} uint8\_t *sh\_cp\_output = \mbox{\hyperlink{AvrPins_8h_a226ee63dda8d186b629801874e9b70ca}{create\_pin\_output\_pointer}}(}
\DoxyCodeLine{87         shift\_register-\/>\mbox{\hyperlink{structshift__register__t_aea8bf2b8dc645d75a480b879e3260b07}{sh\_cp}}}
\DoxyCodeLine{88     );}
\DoxyCodeLine{89 }
\DoxyCodeLine{90     uint8\_t da\_mask = \mbox{\hyperlink{AvrPins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(shift\_register-\/>\mbox{\hyperlink{structshift__register__t_adb4652a86c2fd2a6853f782b7e93a4f6}{da}});}
\DoxyCodeLine{91     uint8\_t st\_cp\_mask = \mbox{\hyperlink{AvrPins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(shift\_register-\/>\mbox{\hyperlink{structshift__register__t_ab4fab70ae11f7521d730e67ab2b31552}{st\_cp}});}
\DoxyCodeLine{92     uint8\_t sh\_cp\_mask = \mbox{\hyperlink{AvrPins_8h_ae12aaef0fa7c78d4ba8bdde7b7e80656}{create\_pin\_mask}}(shift\_register-\/>\mbox{\hyperlink{structshift__register__t_aea8bf2b8dc645d75a480b879e3260b07}{sh\_cp}});}
\DoxyCodeLine{93 }
\DoxyCodeLine{94     \textcolor{keywordtype}{char} to\_send = \mbox{\hyperlink{Latch_8h_a3b1640e5c6eea3c08382b5594ad354a1}{pop\_latch}}(\&shift\_register-\/>\mbox{\hyperlink{structshift__register__t_a8580531b3ac6660af3b447edfdb7bb0d}{latch}});}
\DoxyCodeLine{95 }
\DoxyCodeLine{96     \textcolor{keywordflow}{for} (uint8\_t bit = 8; bit > 0; -\/-\/ bit) \{}
\DoxyCodeLine{97         \textcolor{keywordflow}{if} (to\_send \& (1 << (bit -\/ 1))) *da\_output |= da\_mask;}
\DoxyCodeLine{98         \textcolor{keywordflow}{else} *da\_output \&= \string~da\_mask;}
\DoxyCodeLine{99 }
\DoxyCodeLine{100         *sh\_cp\_output |= sh\_cp\_mask;}
\DoxyCodeLine{101         *sh\_cp\_output \&= \string~sh\_cp\_mask;}
\DoxyCodeLine{102     \}}
\DoxyCodeLine{103 }
\DoxyCodeLine{104     *st\_cp\_output |= st\_cp\_mask;}
\DoxyCodeLine{105     *st\_cp\_output \&= \string~st\_cp\_mask;}
\DoxyCodeLine{106 }
\DoxyCodeLine{107     \textcolor{keywordflow}{return} \mbox{\hyperlink{Process_8h_aeccc645031be90ded0759d4192ce2a97a1501174ec155cb62cc1332781e9b7edf}{GOOD\_STATE}};}
\DoxyCodeLine{108 \}}
\DoxyCodeLine{109 }
\DoxyCodeLine{110 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
